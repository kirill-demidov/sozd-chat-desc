# Пример конфигурации nginx для работы сайта на sozd-chat.org/desc
# Скопируйте эту конфигурацию в ваш файл конфигурации nginx для домена sozd-chat.org

# Вариант 1: Простой proxy (рекомендуется)
location /desc {
    # Убираем /desc из пути и проксируем на GitHub Pages
    rewrite ^/desc/?(.*)$ /sozd-chat-desc/$1 break;
    proxy_pass https://kirill-demidov.github.io;
    
    proxy_set_header Host kirill-demidov.github.io;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Forwarded-Host $host;
    
    # Поддержка WebSocket (если понадобится в будущем)
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
    
    # Кэширование статических файлов
    proxy_cache_valid 200 302 1h;
    proxy_cache_valid 404 1m;
    
    # Обработка redirects - заменяем обратно на /desc
    proxy_redirect https://kirill-demidov.github.io/sozd-chat-desc/ /desc/;
    proxy_redirect https://kirill-demidov.github.io/sozd-chat-desc /desc/;
}

# Вариант 2: С более точным кэшированием (опционально)
# location ~ ^/desc/(.*\.(css|js|png|jpg|jpeg|gif|svg|ico|woff|woff2|ttf|eot))$ {
#     rewrite ^/desc/(.*)$ /sozd-chat-desc/$1 break;
#     proxy_pass https://kirill-demidov.github.io;
#     proxy_set_header Host kirill-demidov.github.io;
#     
#     # Долгое кэширование для статики
#     proxy_cache_valid 200 1d;
#     expires 1d;
#     add_header Cache-Control "public, immutable";
# }

# После добавления конфигурации выполните:
# sudo nginx -t                    # Проверить конфигурацию
# sudo systemctl reload nginx      # Перезагрузить nginx (Ubuntu/Debian)
# sudo systemctl restart nginx     # Или перезапустить (если reload не работает)
